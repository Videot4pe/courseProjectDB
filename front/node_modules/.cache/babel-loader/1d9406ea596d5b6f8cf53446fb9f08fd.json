{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _boltProtocolV = _interopRequireDefault(require(\"./bolt-protocol-v2\"));\n\nvar _requestMessage = _interopRequireDefault(require(\"./request-message\"));\n/**\n * Copyright (c) 2002-2019 \"Neo4j,\"\n * Neo4j Sweden AB [http://neo4j.com]\n *\n * This file is part of Neo4j.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nvar BoltProtocol =\n/*#__PURE__*/\nfunction (_BoltProtocolV) {\n  (0, _inherits2[\"default\"])(BoltProtocol, _BoltProtocolV);\n\n  function BoltProtocol() {\n    (0, _classCallCheck2[\"default\"])(this, BoltProtocol);\n    return (0, _possibleConstructorReturn2[\"default\"])(this, (0, _getPrototypeOf2[\"default\"])(BoltProtocol).apply(this, arguments));\n  }\n\n  (0, _createClass2[\"default\"])(BoltProtocol, [{\n    key: \"transformMetadata\",\n    value: function transformMetadata(metadata) {\n      if ('t_first' in metadata) {\n        // Bolt V3 uses shorter key 't_first' to represent 'result_available_after'\n        // adjust the key to be the same as in Bolt V1 so that ResultSummary can retrieve the value\n        metadata.result_available_after = metadata.t_first;\n        delete metadata.t_first;\n      }\n\n      if ('t_last' in metadata) {\n        // Bolt V3 uses shorter key 't_last' to represent 'result_consumed_after'\n        // adjust the key to be the same as in Bolt V1 so that ResultSummary can retrieve the value\n        metadata.result_consumed_after = metadata.t_last;\n        delete metadata.t_last;\n      }\n\n      return metadata;\n    }\n  }, {\n    key: \"initialize\",\n    value: function initialize(userAgent, authToken, observer) {\n      prepareToHandleSingleResponse(observer);\n\n      var message = _requestMessage[\"default\"].hello(userAgent, authToken);\n\n      this._connection.write(message, observer, true);\n    }\n  }, {\n    key: \"prepareToClose\",\n    value: function prepareToClose(observer) {\n      var message = _requestMessage[\"default\"].goodbye();\n\n      this._connection.write(message, observer, true);\n    }\n  }, {\n    key: \"beginTransaction\",\n    value: function beginTransaction(bookmark, txConfig, mode, observer) {\n      prepareToHandleSingleResponse(observer);\n\n      var message = _requestMessage[\"default\"].begin(bookmark, txConfig, mode);\n\n      this._connection.write(message, observer, true);\n    }\n  }, {\n    key: \"commitTransaction\",\n    value: function commitTransaction(observer) {\n      prepareToHandleSingleResponse(observer);\n\n      var message = _requestMessage[\"default\"].commit();\n\n      this._connection.write(message, observer, true);\n    }\n  }, {\n    key: \"rollbackTransaction\",\n    value: function rollbackTransaction(observer) {\n      prepareToHandleSingleResponse(observer);\n\n      var message = _requestMessage[\"default\"].rollback();\n\n      this._connection.write(message, observer, true);\n    }\n  }, {\n    key: \"run\",\n    value: function run(statement, parameters, bookmark, txConfig, mode, observer) {\n      var runMessage = _requestMessage[\"default\"].runWithMetadata(statement, parameters, bookmark, txConfig, mode);\n\n      var pullAllMessage = _requestMessage[\"default\"].pullAll();\n\n      this._connection.write(runMessage, observer, false);\n\n      this._connection.write(pullAllMessage, observer, true);\n    }\n  }]);\n  return BoltProtocol;\n}(_boltProtocolV[\"default\"]);\n\nexports[\"default\"] = BoltProtocol;\n\nfunction prepareToHandleSingleResponse(observer) {\n  if (observer && typeof observer.prepareToHandleSingleResponse === 'function') {\n    observer.prepareToHandleSingleResponse();\n  }\n}","map":null,"metadata":{},"sourceType":"script"}